function l(r){return S(r)||b(r)||w(r)||I()}function I(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function b(r){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(r))return Array.from(r)}function S(r){if(Array.isArray(r))return h(r)}function y(r,n){return L(r)||C(r,n)||w(r,n)||A()}function A(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function w(r,n){if(!r)return;if(typeof r=="string")return h(r,n);var e=Object.prototype.toString.call(r).slice(8,-1);if(e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set")return Array.from(r);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return h(r,n)}function h(r,n){(n==null||n>r.length)&&(n=r.length);for(var e=0,t=new Array(n);e<n;e++)t[e]=r[e];return t}function C(r,n){if(typeof Symbol=="undefined"||!(Symbol.iterator in Object(r)))return;var e=[],t=!0,o=!1,s=void 0;try{for(var i=r[Symbol.iterator](),a;!(t=(a=i.next()).done)&&!(e.push(a.value),n&&e.length===n);t=!0);}catch(u){o=!0,s=u}finally{try{!t&&i.return!=null&&i.return()}finally{if(o)throw s}}return e}function L(r){if(Array.isArray(r))return r}import P from"../instructions/index.js";var x=["bcc","bcs","beq","bne","bmi","bpl","bvs","bvc"];export function compileParam(r){var n=/\(?(#)?(\$?)([\da-f]+)\)?(?:,([xy]))?\)?/.exec(r.toLowerCase()),e,t="IMP";if(!n||r.toLowerCase()==="a")return{params:[],addressingMode:t};var o=/\(\$[\da-f]+\)/.exec(r.toLowerCase()),s=/\(\$[\da-f]+,x\)/.exec(r.toLowerCase()),i=/\(\$[\da-f]+\),y/.exec(r.toLowerCase()),a=y(n,5),u=a[1],p=a[2],d=a[3],f=a[4],c=p?parseInt(d,16):parseInt(d,10),m=d.length<=2;return u||m?e=[c]:e=[c&255,c>>8&255],u?t="IMM":!m&&o?t="IND":s?t="IZX":i?t="IZY":f?t=m?"ZP".concat(f.toUpperCase()):"AB".concat(f.toUpperCase()):t=m?"ZP0":"ABS",{params:e,addressingMode:t}}export function assembleLine(r){var n=r.toLowerCase(),e=/([a-z]+)(\s+.+?)?$/.exec(n),t=y(e,3),o=t[1],s=t[2],i=compileParam((s??"").trim()),a=i.params,u=i.addressingMode;x.includes(o)&&(u="REL");var p=Object.entries(P).find(function(d){var f=y(d,2),c=f[1];return c.name.toLowerCase()===o&&c.addressingName===u});return[Number(p[0])].concat(l(a))}export function labelLines(r){for(var n=[],e=0,t=function(m){var v=1,g=m.split(/\s+/);return g[0].toLowerCase()==="jmp"&&!/\(.+?\)/.test(g[1])?v=3:x.includes(g[0].toLowerCase())?v=2:v=assembleLine(m).length,v},o=0;o<r.length;o++){var s=r[o],i=/\s*(.+?):\s*(.+)?$/.exec(s.trim());if(i){var a,u;if(o+1===r.length&&!i[2])throw new Error("Label without associated instruction");i[2]||(o+=1);var p=(a=(u=i[2])===null||u===void 0?void 0:u.trim())!==null&&a!==void 0?a:r[o],d=t(p);n.push([e,p,i[1]]),e+=d}else{var f=t(s);n.push([e,s,void 0]),e+=f}}return n}export function compileLabelToAddress(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e={};r.forEach(function(o){var s=y(o,3),i=s[0],a=s[2];a&&(e[a]=i)});var t=[];return r.forEach(function(o){var s=y(o,3),i=s[0],a=s[1],u=s[2],p=a.split(/\s+/),d=y(p,2),f=d[0],c=d[1];if(e[c]!=null)if(x.includes(f.toLowerCase())){var m=new Uint8Array([e[c]-i-2])[0];a="".concat(f," $").concat(m.toString(16).padStart(2,"0"))}else{var v=n+e[c];a="".concat(f," $").concat(v.toString(16).padStart(4,"0"))}t.push([i,a,u])}),t}export function assemble(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=r.trim().split(`
`).map(function(t){return t.trim()});return e=labelLines(e),e=compileLabelToAddress(e,n),e=e.map(function(t){return assembleLine(t[1])}),e.reduce(function(t,o){return[].concat(l(t),l(o))},[])}export default function j(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{memorySize:1536,PC:1536},n=r.memorySize,e=r.PC;return function(o){for(var s=new Uint8Array(l(new Array(n)).map(function(u){return 0})),i=assemble(o[0],e),a=e;a<e+i.length;a++)s[a]=i[a-e];return s}}
