function b(r){return S(r)||x(r)||h(r)||w()}function w(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function x(r){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(r))return Array.from(r)}function S(r){if(Array.isArray(r))return y(r)}function p(r,n){return L(r)||C(r,n)||h(r,n)||A()}function A(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function h(r,n){if(!r)return;if(typeof r=="string")return y(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return y(r,n)}function y(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}function C(r,n){if(typeof Symbol=="undefined"||!(Symbol.iterator in Object(r)))return;var t=[],e=!0,a=!1,u=void 0;try{for(var o=r[Symbol.iterator](),i;!(e=(i=o.next()).done)&&!(t.push(i.value),n&&t.length===n);e=!0);}catch(c){a=!0,u=c}finally{try{!e&&o.return!=null&&o.return()}finally{if(a)throw u}}return t}function L(r){if(Array.isArray(r))return r}import I from"../instructions/index.js";var g=["bcc","bcs","beq","bne","bmi","bpl","bvs","bvc"];export function compileParam(r){var n=/\(?(#)?(\$?)([\da-f]+)\)?(?:,([xy]))?\)?/.exec(r.toLowerCase()),t,e="IMP";if(!n||r.toLowerCase()==="a")return{params:[],addressingMode:e};var a=/\(\$[\da-f]+\)/.exec(r.toLowerCase()),u=/\(\$[\da-f]+,x\)/.exec(r.toLowerCase()),o=/\(\$[\da-f]+\),y/.exec(r.toLowerCase()),i=p(n,5),c=i[1],d=i[2],m=i[3],f=i[4],s=d?parseInt(m,16):parseInt(m,10),l=m.length<=2;return c||l?t=[s]:t=[s&255,s>>8&255],c?e="IMM":!l&&a?e="IND":u?e="IZX":o?e="IZY":f?e=l?"ZP".concat(f.toUpperCase()):"AB".concat(f.toUpperCase()):e=l?"ZP0":"ABS",{params:t,addressingMode:e}}export function assembleLine(r){var n=r.toLowerCase(),t=/([a-z]+)(\s+.+?)?$/.exec(n),e=p(t,3),a=e[1],u=e[2],o=compileParam((u??"").trim()),i=o.params,c=o.addressingMode;g.includes(a)&&(c="REL");var d=Object.entries(I).find(function(m){var f=p(m,2),s=f[1];return s.name.toLowerCase()===a&&s.addressingName===c});return[Number(d[0])].concat(b(i))}export function labelLines(r){for(var n=[],t=0,e=function(s){var l=1,v=s.split(/\s+/);return v[0].toLowerCase()==="jmp"&&!/\(.+?\)/.test(v[1])?l=3:g.includes(v[0].toLowerCase())?l=2:l=assembleLine(s).length,l},a=0;a<r.length;a++){var u=r[a],o=/\s*(.+?):\s*(.+)?$/.exec(u.trim());if(o){var i,c;if(a+1===r.length&&!o[2])throw new Error("Label without associated instruction");o[2]||(a+=1);var d=(i=(c=o[2])===null||c===void 0?void 0:c.trim())!==null&&i!==void 0?i:r[a],m=e(d);n.push([t,d,o[1]]),t+=m}else{var f=e(u);n.push([t,u,void 0]),t+=f}}return n}export function compileLabelToAddress(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t={};r.forEach(function(a){var u=p(a,3),o=u[0],i=u[2];i&&(t[i]=o)});var e=[];return r.forEach(function(a){var u=p(a,3),o=u[0],i=u[1],c=u[2],d=i.split(/\s+/),m=p(d,2),f=m[0],s=m[1];if(t[s]!=null)if(g.includes(f.toLowerCase())){var l=new Uint8Array([t[s]-o-2])[0];i="".concat(f," $").concat(l.toString(16).padStart(2,"0"))}else{var v=n+t[s];i="".concat(f," $").concat(v.toString(16).padStart(4,"0"))}e.push([o,i,c])}),e}export function assemble(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=r.trim().split(`
`).map(function(e){return e.trim()});return t=labelLines(t),t=compileLabelToAddress(t,n),t=t.map(function(e){return assembleLine(e[1])}),t.reduce(function(e,a){return[].concat(b(e),b(a))},[])}export default function j(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{memorySize:1536,PC:1536},n=r.memorySize,t=r.PC;return function(e){for(var a=new Uint8Array(b(new Array(n)).map(function(i){return 0})),u=assemble(e[0],t),o=t;o<t+u.length;o++)a[o]=u[o-t];return a}}
