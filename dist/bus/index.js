function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}var h=function(){function e(t,i){p(this,e),this.cpu=t,this.ppu=i,this.cpu.connect(this),this.initVRAM(),this.globalSystemClockNumber=0}return f(e,[{key:"initVRAM",value:function(){var t=this,i=new Uint8Array(65536),r=this,l=new Proxy(i,{get:function(c,n){var o,u=Number(n);if(isNaN(u))return typeof c[n]=="function"?c[n].bind(c):c[n];var a=(o=r.cartridge)===null||o===void 0?void 0:o.cpuRead(u);return a||(u<8192?c[u&2047]:u<16384?t.ppu.cpuRead(u&7):0)},set:function(c,n,o){var u,a=Number(n);if(isNaN(a))c[n]=o;else{if((u=r.cartridge)===null||u===void 0?void 0:u.cpuWrite(a,o))return!0;a<8192?c[n&2047]=o:a<16384&&t.ppu.cpuWrite(a&7,o)}return!0}});this.cpu.ram=l,this.ram=l}},{key:"insertCartridge",value:function(t){this.cartridge=t,this.ppu.insertCartridge(t)}},{key:"reset",value:function(){this.cpu.reset(),this.globalSystemClockNumber=0}},{key:"clock",value:function(){this.ppu.clock(),this.globalSystemClockNumber%3===0&&this.cpu.atomicClock(),this.globalSystemClockNumber+=1}}]),e}();export{h as default};
