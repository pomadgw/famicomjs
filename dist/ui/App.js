import{SvelteComponent as le,append as n,attr as f,binding_callbacks as x,check_outros as ie,create_component as $,destroy_component as ee,detach as te,element as a,group_outros as ae,init as fe,insert as ne,listen as j,mount_component as se,run_all as ue,safe_not_equal as ce,set_data as oe,space as d,text as I,transition_in as D,transition_out as G}from"../../web_modules/svelte/internal.js";import{onMount as me}from"../../web_modules/svelte.js";import pe from"./RAM.js";import ge from"./Register.js";import de from"../cartridge/index.js";import he from"../bus/index.js";import Se from"../6502/cpu.js";import _e from"../ppu/index.js";function re(s){let m,t,e;return t=new pe({props:{ram:s[0].cpu.ram,offsetStart:s[5],offsetEnd:s[5]+48}}),{c(){m=a("div"),$(t.$$.fragment),f(m,"class","mt-4")},m(o,p){ne(o,m,p),se(t,m,null),e=!0},p(o,p){const u={};p&1&&(u.ram=o[0].cpu.ram),p&32&&(u.offsetStart=o[5]),p&32&&(u.offsetEnd=o[5]+48),t.$set(u)},i(o){if(e)return;D(t.$$.fragment,o),e=!0},o(o){G(t.$$.fragment,o),e=!1},d(o){o&&te(m),ee(t)}}}function be(s){let m,t,e,o,p,u,N,l,_,h,g,b,U,B,k,R,v,q,E,T,w,r,F=(s[3]?"on":"off")+"",M,L,S,W,O,z,Q,y=s[5].toString(16).padStart(4,"0")+"",H,V,J,A,X,P,K,Y;A=new ge({props:{registers:s[6]}});let i=s[0].cartridge&&s[4]&&re(s);return{c(){m=a("div"),t=a("div"),e=a("div"),o=a("canvas"),p=d(),u=a("canvas"),N=d(),l=a("div"),_=a("input"),h=d(),g=a("label"),b=a("input"),U=I(`
        Show RAM content`),B=d(),k=a("button"),k.textContent="Reset",R=d(),v=a("button"),v.textContent="Execute Code Step-by-Step",q=d(),E=a("button"),E.textContent="Execute Code for Whole Frame",T=d(),w=a("button"),r=I("Toggle Emulation: "),M=I(F),L=d(),S=a("div"),W=a("div"),O=I("PC: "),z=a("span"),Q=I("$"),H=I(y),V=d(),J=a("div"),$(A.$$.fragment),X=d(),i&&i.c(),f(o,"class","hidden"),f(o,"width","256"),f(o,"height","240"),f(u,"width","640"),f(u,"height","480"),f(_,"type","file"),f(b,"type","checkbox"),f(k,"class","ml-2"),f(v,"class","ml-2"),f(E,"class","ml-2"),f(w,"class","ml-2"),f(l,"class","flex items-center mt-4"),f(t,"class","flex flex-col flex-2"),f(z,"class","font-mono"),f(S,"class","ml-4 flex-1 flex flex-col"),f(m,"class","flex m-auto p-10")},m(c,C){ne(c,m,C),n(m,t),n(t,e),n(e,o),s[12](o),n(e,p),n(e,u),s[13](u),n(t,N),n(t,l),n(l,_),n(l,h),n(l,g),n(g,b),b.checked=s[4],n(g,U),n(l,B),n(l,k),n(l,R),n(l,v),n(l,q),n(l,E),n(l,T),n(l,w),n(w,r),n(w,M),n(m,L),n(m,S),n(S,W),n(W,O),n(W,z),n(z,Q),n(z,H),n(S,V),n(S,J),se(A,J,null),n(S,X),i&&i.m(S,null),P=!0,K||(Y=[j(_,"change",s[8]),j(b,"change",s[14]),j(k,"click",s[9]),j(v,"click",s[10]),j(E,"click",s[11]),j(w,"click",s[7])],K=!0)},p(c,[C]){C&16&&(b.checked=c[4]),(!P||C&8)&&F!==(F=(c[3]?"on":"off")+"")&&oe(M,F),(!P||C&32)&&y!==(y=c[5].toString(16).padStart(4,"0")+"")&&oe(H,y);const Z={};C&64&&(Z.registers=c[6]),A.$set(Z),c[0].cartridge&&c[4]?i?(i.p(c,C),C&17&&D(i,1)):(i=re(c),i.c(),D(i,1),i.m(S,null)):i&&(ae(),G(i,1,1,()=>{i=null}),ie())},i(c){if(P)return;D(A.$$.fragment,c),D(i),P=!0},o(c){G(A.$$.fragment,c),G(i),P=!1},d(c){c&&te(m),s[12](null),s[13](null),ee(A),i&&i.d(),K=!1,ue(Y)}}}function we(s,m,t){let e,o,p,u=!1,N,l,_=!0,h=32768,g;e=new he(new Se(),new _e());function b(){t(3,u=!u)}async function U(r){const F=r.target.files[0],M=new de();await M.parse(F),t(0,e.cartridge=M,e),e.insertCartridge(M),e.reset(),t(5,h=e.cpu.registers.PC),t(6,g=e.cpu.registers)}function B(){e.reset(),t(5,h=e.cpu.registers.PC),t(6,g=e.cpu.registers)}function k(){do e.clock();while(!e.cpu.isComplete);do e.clock();while(e.cpu.isComplete);t(5,h=e.cpu.registers.PC),t(6,g=e.cpu.registers),R()}function R(){const r=p.getContext("2d");N.putImageData(e.ppu.getScreen().imageData,0,0),r.imageSmoothingEnabled=!1,r.mozImageSmoothingEnabled=!1,r.webkitImageSmoothingEnabled=!1,r.msImageSmoothingEnabled=!1,r.drawImage(o,0,0,256,240,0,0,512,480)}function v(){do e.clock();while(!e.ppu.isFrameComplete);do e.clock();while(e.cpu.isComplete);t(0,e.ppu.isFrameComplete=!1,e),t(5,h=e.cpu.registers.PC),t(6,g=e.cpu.registers),R()}function q(r){if(u){if(l||(l=r),r-l>=1e3/60){l=r;do e.clock();while(!e.ppu.isFrameComplete);t(0,e.ppu.isFrameComplete=!1,e),t(5,h=e.cpu.registers.PC),t(6,g=e.cpu.registers),R()}requestAnimationFrame(q)}}me(()=>{N=o.getContext("2d")});function E(r){x[r?"unshift":"push"](()=>{o=r,t(1,o)})}function T(r){x[r?"unshift":"push"](()=>{p=r,t(2,p)})}function w(){_=this.checked,t(4,_)}return s.$$.update=()=>{if(s.$$.dirty&8){e:u&&requestAnimationFrame(q)}},[e,o,p,u,_,h,g,b,U,B,k,v,E,T,w]}class Ce extends le{constructor(s){super();fe(this,s,we,be,ce,{})}}export default Ce;
