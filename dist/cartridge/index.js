function d(n,t,e,r,a,u,p){try{var i=n[u](p),s=i.value}catch(m){e(m);return}i.done?t(s):Promise.resolve(s).then(r,a)}function g(n){return function(){var t=this,e=arguments;return new Promise(function(r,a){var u=n.apply(t,e);function p(s){d(u,r,a,p,i,"next",s)}function i(s){d(u,r,a,p,i,"throw",s)}p(void 0)})}}function b(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function l(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function M(n,t,e){return t&&l(n.prototype,t),e&&l(n,e),n}import w from"../mappers/index.js";import v from"../ppu/mirror-mode.js";var A=function(){function n(){b(this,n),this.prgMemory=[],this.chrMemory=[],this.mapperId=0,this.prgBankNumber=0,this.chrBankNumber=0}return M(n,[{key:"parse",value:function(){var t=g(regeneratorRuntime.mark(function r(a){var u,p,i,s,m,o,h,f;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return u=new FileReader(),c.next=3,new Promise(function(y,B){u.addEventListener("load",function(k){y(k.target.result)}),u.readAsArrayBuffer(a)});case 3:p=c.sent,i=new Uint8Array(p),s=i[6],m=i[7],this.mapperId=m>>4<<4|s>>4,this.mirrorMode=(s&1)>0?v.VERTICAL:v.HORIZONTAL,o=16,(s&4)>0&&(o+=512),h=1,h===0||(h===1?(this.prgBankNumber=i[4],this.chrBankNumber=i[5],this.prgMemory=i.slice(o,o+this.prgBankNumber*16384),o+=this.prgBankNumber*16384,this.chrMemory=i.slice(o,o+this.chrBankNumber*8192)):h===2),f=w[this.mapperId],f&&(this.mapper=new f(this.prgBankNumber,this.chrBankNumber));case 15:case"end":return c.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"cpuRead",value:function(t){var e=this.mapper.cpuMapRead(t),r=e.status,a=e.mappedAddress;return r?this.prgMemory[a]:null}},{key:"cpuWrite",value:function(t,e){var r=this.mapper.cpuMapWrite(t),a=r.status,u=r.mappedAddress;return a?(this.prgMemory[u]=e,!0):null}},{key:"ppuRead",value:function(t){var e=this.mapper.ppuMapRead(t),r=e.status,a=e.mappedAddress;return r?this.chrMemory[a]:null}},{key:"ppuWrite",value:function(t,e){var r=this.mapper.ppuMapWrite(t),a=r.status,u=r.mappedAddress;return a?(this.chrMemory[u]=e,!0):null}}]),n}();export{A as default};
