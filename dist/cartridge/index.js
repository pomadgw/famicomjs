function d(u,a,r,e,t,n,s){try{var p=u[n](s),i=p.value}catch(f){r(f);return}p.done?a(i):Promise.resolve(i).then(e,t)}function g(u){return function(){var a=this,r=arguments;return new Promise(function(e,t){var n=u.apply(a,r);function s(i){d(n,e,t,s,p,"next",i)}function p(i){d(n,e,t,s,p,"throw",i)}s(void 0)})}}function k(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function o(u,a){for(var r=0;r<a.length;r++){var e=a[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(u,e.key,e)}}function _(u,a,r){return a&&o(u.prototype,a),r&&o(u,r),u}import M from"../mappers/index.js";var b=function(){function u(){k(this,u),this.prgMemory=[],this.chrMemory=[],this.mapperId=0,this.prgBankNumber=0,this.chrBankNumber=0}return _(u,[{key:"parse",value:function(){var a=g(regeneratorRuntime.mark(function e(t){var n,s,p,i,f,m,l,c;return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return n=new FileReader(),h.next=3,new Promise(function(y,R){n.addEventListener("load",function(v){y(v.target.result)}),n.readAsArrayBuffer(t)});case 3:s=h.sent,p=new Uint8Array(s),i=p[6],f=p[7],this.mapperId=f>>4<<4|i>>4,m=16,(i&4)>0&&(m+=512),l=1,l===0||(l===1?(this.prgBankNumber=p[4],this.chrBankNumber=p[5],this.prgMemory=p.slice(m,m+this.prgBankNumber*16384),m+=this.prgBankNumber*16384,this.chrMemory=p.slice(m,m+this.chrBankNumber*8192)):l===2),c=M[this.mapperId],c&&(this.mapper=new c(this.prgBankNumber,this.chrBankNumber));case 14:case"end":return h.stop()}},e,this)}));function r(e){return a.apply(this,arguments)}return r}()},{key:"cpuRead",value:function(r){var e=this.mapper.cpuMapRead(r),t=e.status,n=e.mappedAddress;return t?this.prgMemory[n]:null}},{key:"cpuWrite",value:function(r,e){var t=this.mapper.cpuMapWrite(r),n=t.status,s=t.mappedAddress;return n?(this.prgMemory[s]=e,!0):null}},{key:"ppuRead",value:function(r){var e=this.mapper.ppuMapRead(r),t=e.status,n=e.mappedAddress;return t?this.chrMemory[n]:null}},{key:"ppuWrite",value:function(r,e){var t=this.mapper.ppuMapWrite(r),n=t.status,s=t.mappedAddress;return n?(this.chrMemory[s]=e,!0):null}}]),u}();export{b as default};
