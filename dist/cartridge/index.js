function l(n,t,e,r,a,i,p){try{var u=n[i](p),s=u.value}catch(m){e(m);return}u.done?t(s):Promise.resolve(s).then(r,a)}function g(n){return function(){var t=this,e=arguments;return new Promise(function(r,a){var i=n.apply(t,e);function p(s){l(i,r,a,p,u,"next",s)}function u(s){l(i,r,a,p,u,"throw",s)}p(void 0)})}}function k(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function d(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function b(n,t,e){return t&&d(n.prototype,t),e&&d(n,e),n}import M from"../mappers/index.js";var w=function(){function n(){k(this,n),this.prgMemory=[],this.chrMemory=[],this.mapperId=0,this.prgBankNumber=0,this.chrBankNumber=0}return b(n,[{key:"parse",value:function(){var t=g(regeneratorRuntime.mark(function r(a){var i,p,u,s,m,o,h,f;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return i=new FileReader(),c.next=3,new Promise(function(v,B){i.addEventListener("load",function(y){v(y.target.result)}),i.readAsArrayBuffer(a)});case 3:p=c.sent,u=new Uint8Array(p),s=u[6],m=u[7],this.mapperId=m>>4<<4|s>>4,o=16,(s&4)>0&&(o+=512),h=1,h===0||(h===1?(this.prgBankNumber=u[4],this.chrBankNumber=u[5],this.prgMemory=u.slice(o,o+this.prgBankNumber*16384),o+=this.prgBankNumber*16384,this.chrMemory=u.slice(o,o+this.chrBankNumber*8192)):h===2),f=M[this.mapperId],f&&(this.mapper=new f(this.prgBankNumber,this.chrBankNumber));case 14:case"end":return c.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e}()},{key:"cpuRead",value:function(t){var e=this.mapper.cpuMapRead(t),r=e.status,a=e.mappedAddress;return r?this.prgMemory[a]:null}},{key:"cpuWrite",value:function(t,e){var r=this.mapper.cpuMapWrite(t),a=r.status,i=r.mappedAddress;return a?(this.prgMemory[i]=e,!0):null}},{key:"ppuRead",value:function(t){var e=this.mapper.ppuMapRead(t),r=e.status,a=e.mappedAddress;return r?this.chrMemory[a]:null}},{key:"ppuWrite",value:function(t,e){var r=this.mapper.ppuMapWrite(t),a=r.status,i=r.mappedAddress;return a?(this.chrMemory[i]=e,!0):null}}]),n}();export{w as default};
